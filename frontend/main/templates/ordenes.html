{% extends 'base.html' %}

{% block head %}
<title>Momi ERP/POS - Ordenes</title>
{% endblock %}

{% block content %}


<div class="level">
    <div class="level-left">
      <div class="level-item">
          <div class="title">&Oacute;rdenes de Venta</div>
      </div>
    </div>
  </div>

  <div class="columns is-multiline">

    <div class="column">
      <div class="box">
        <div class="heading">Cantidad</div>
        <div class="title" id="act_cantidad">{{ "{:,.0f}".format(datos.cantidad or 0) }}</div>
        <div class="level">
          <div class="level-item">
            <div class="">
              <div class="heading">Lineas de Detalle</div>
              <div class="title is-5" id="act_lineas">{{ datos.lineas or 0 }}</div>
            </div>
          </div>
          <div class="level-item">
            <div class="">
              <div class="heading">Clientes</div>
              <div class="title is-5" id="act_clientes">{{datos.clientes or 0}}</div>
            </div>
          </div>
          <div class="level-item">
            <div class="">
              <div class="heading">Ubicaciones</div>
              <div class="title is-5" id="act_ubicaciones">{{datos.ubicaciones or 0}}</div>
            </div>
          </div>
          <div class="level-item">
            <div class="">
              <div class="heading">Monto</div>
              <div class="title is-5" id="act_monto">{{ "${:,.2f}".format(datos.monto or 0)  }}</div>
            </div>
          </div>
          </div>
        </div>
      </div>
    </div>
   
  

  <div class="field">
    <p class="control">
      <!--form action="/items"-->
        <button  id="procesar" class="button is-success">
           Descargar
        </button>
    <!--/form-->
    </p>
    <p id="mensajes"></p>
  </div>

  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
  <script type="text/javascript" charset="utf-8">
      var socket = io.connect('http://' + document.domain + ':' + location.port);
  
      let button = document.getElementById('procesar');
      let mensajes = document.getElementById("mensajes");
   
      button.addEventListener('click', () => {
        mensajes.innerHTML = "" ;
        socket.emit('proceso', {data: 'orders'}); 
      });
  
      socket.on('orders.procesando', function (data) {
            
            x = JSON.parse(data).data
            button.disabled = true ;
            document.body.style.cursor = 'wait';
            document.getElementById('act_cantidad').innerHTML = x.cantidad ;
            document.getElementById('act_lineas').innerHTML = x.lineas ;
            document.getElementById('act_monto').innerHTML = ".." ;
            document.getElementById('act_clientes').innerHTML = ".." ;
            document.getElementById('act_ubicaciones').innerHTML = ".." ;

      })

      socket.on('orders.mensajes', function (data) {
        mensajes.innerHTML += "<br>" + JSON.parse(data).data
      });

      socket.on('orders.procesado', function (data) {
        mensajes.innerHTML += "<br>" + JSON.parse(data).data ;
        button.disabled = false;
        document.body.style.cursor = 'default';
        setTimeout(() => {  window.location.reload(); }, 2000); //mil milisegundos = 1 segundo
        
      });
      

  </script>


  {% endblock %}